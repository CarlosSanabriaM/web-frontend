<h2>{{sectionName}}</h2>

<div class="card">
  <mat-tab-group color="primary" dynamicHeight mat-stretch-tabs>
    <!-- Tab 1 -->
    <mat-tab>
      <!-- Mat tab header content -->
      <ng-template mat-tab-label>
        <!-- TODO: In small screen sizes, remove the text of the tab and show only the icon -->
        <h3 class="tab-label-text">Texto</h3>
        <mat-icon class="tab-icon">text_format</mat-icon>
      </ng-template>
      <!-- Mat tab content -->
      <!-- TODO: Uncomment when the TopicsTextComponent is created: <app-topics-text></app-topics-text> -->
      <!-- m-2 sets margin on 4 sides to $spacer * .5 -->
      <div class="m-2" id="topics-text-format">
        <table class="table table-striped table-hover table-sm">
          <thead class="thead-light">
          <tr>
            <th scope="col">Núm. topic</th>
            <th scope="col">Keywords</th>
            <th scope="col"></th>
          </tr>
          </thead>

          <tr *ngFor="let topic of topics">
            <th scope="row">{{topic.topic}}</th>
            <td>
              <span *ngFor="let keyword of topic.keywords">
                <span class="font-weight-bold">{{keyword.name}}</span>: {{keyword.probability | percent:'1.2'}}
              </span>
            </td>
            <td>
              <!-- When the mouse hovers the document icon button, a tooltip explains how to use it -->
              <!-- If the topic documents are loading, the button is disabled -->
              <button #documentTooltip="matTooltip" (click)="getTopicDocuments(topic.topic)"
                      (mouseenter)="documentTooltip.show()"
                      (mouseleave)="documentTooltip.hide()"
                      [disabled]="topicDocumentsCardComponent.topicDocumentsLoading" class="btn p-0"
                      matTooltip="Click to show the most representative documents of topic {{topic.topic}}"
                      matTooltipPosition="left">
                <!-- Document icon -->
                <mat-icon>description</mat-icon>
              </button>
            </td>
          </tr>
        </table>
      </div>
    </mat-tab>

    <!-- Tab 2 -->
    <mat-tab>

      <!-- Mat tab header content -->
      <ng-template mat-tab-label>
        <h3 class="tab-label-text">Nube de palabras</h3>
        <mat-icon class="tab-icon">cloud</mat-icon>
      </ng-template>

      <!-- Mat tab content -->
      <!-- If the wordcloud images are loading, show a progress spinner -->
      <div *ngIf="wordcloudImagesLoading; else wordcloudImagesLoaded">
        <mat-spinner color="primary" id="wordcloud-images-progress-spinner"></mat-spinner>
      </div>

      <!-- If the wordcloud images have been loaded, show them -->
      <ng-template #wordcloudImagesLoaded>
        <!-- If the wordcloud images have been loaded, show them -->
        <!-- m-2 sets margin on 4 sides to $spacer * .5 -->
        <div class="m-2" id="topics-wordcloud-format">
          <div class="row">
            <!--
              * In extra large screens, each wordcloud has width 3/12, so there are 4 wordclouds per row.
              * In medium and large screens, each wordcloud has width 4/12, so there are 3 wordclouds per row.
              * In small screens, each wordcloud has width 6/12, so there are 2 wordclouds per row.
              * In extra small screens, each wordcloud has width 12/12, so there is only 1 wordcloud per row.
            -->
            <div *ngFor="let topicImageUrl of topicImageUrls" class="col-xl-3 col-md-4 col-sm-6 col-12">
              <div class="card">
                <img [src]="topicImageUrl.image_url" alt="Topic{{topicImageUrl.topic}} wordcloud image"
                     class="topic-wordcloud-image">
                <div class="card-body">
                  <!-- If the topic documents are loading, the button is disabled -->
                  <button (click)="getTopicDocuments(topicImageUrl.topic)"
                          [disabled]="topicDocumentsCardComponent.topicDocumentsLoading"
                          class="topic-wordcloud-image-footer-button btn btn-outline-secondary btn-sm align">
                    Documentos más representativos
                  </button>
                </div>
              </div>

            </div>
          </div>
        </div>
      </ng-template>

    </mat-tab>

    <!--
      TODO: Implement this with modals: https://ng-bootstrap.github.io/#/components/modal/examples
       or https://ng.ant.design/components/modal/en
    -->
    <!-- Tab 3 -->
    <mat-tab>
      <!-- TODO: Try to decrease this tab header width -->
      <!-- Mat tab header content -->
      <ng-template mat-tab-label>
        <h3 class="tab-label-text">Configuración</h3>
        <mat-icon class="tab-icon">settings</mat-icon>
      </ng-template>
      <!-- Mat tab content -->
      <!-- m-2 sets margin on 4 sides to $spacer * .5 -->
      <div class="m-2" id="configuration-section">

        <!-- Wrap the configurations in a bootstrap card -->
        <div class="card">
          <ul class="list-group list-group-flush">
            <li class="list-group-item" id="configuration-section-text">
              <h4>Formato Texto</h4>

              <!-- Slider with min and max values at it sides -->
              <span class="text-small text-secondary slider-min-value">{{numKeywordsTextFormatMinValue}}</span>
              <mat-slider #sliderNumKeywordsTextFormat [max]="numKeywordsTextFormatMaxValue"
                          [min]="numKeywordsTextFormatMinValue"
                          [value]="numKeywordsTextFormat" color="primary"
                          thumbLabel></mat-slider>
              <span class="text-small text-secondary slider-max-value">{{numKeywordsTextFormatMaxValue}}</span>
              <p class="slider-footer">Número de keywords</p>
            </li>
            <li class="list-group-item" id="configuration-section-wordcloud">
              <h4>Formato Nube de palabras</h4>

              <!-- Slider with min and max values at it sides -->
              <span class="text-small text-secondary slider-min-value">{{numKeywordsWordcloudFormatMinValue}}</span>
              <mat-slider #sliderNumKeywordsWordcloudFormat [max]="numKeywordsWordcloudFormatMaxValue"
                          [min]="numKeywordsWordcloudFormatMinValue"
                          [value]="numKeywordsWordcloudFormat" color="primary"
                          thumbLabel></mat-slider>
              <span class="text-small text-secondary slider-max-value">{{numKeywordsWordcloudFormatMaxValue}}</span>
              <p class="slider-footer">Número de keywords</p>
            </li>
            <li class="list-group-item" id="configuration-section-topic-documents">
              <h4>Documentos más representativos</h4>

              <!-- Slider with min and max values at it sides -->
              <span class="text-small text-secondary slider-min-value">{{numTopicDocumentsMinValue}}</span>
              <mat-slider #sliderNumTopicDocuments [max]="numTopicDocumentsMaxValue" [min]="numTopicDocumentsMinValue"
                          [value]="numTopicDocuments" color="primary" thumbLabel></mat-slider>
              <span class="text-small text-secondary slider-max-value">{{numTopicDocumentsMaxValue}}</span>
              <p class="slider-footer">Número de documentos</p>
            </li>
            <li class="list-group-item">
              <!-- Button to confirm all changes -->
              <button (click)="updateVariablesAndRefreshTopics(sliderNumKeywordsTextFormat.value,
                                                       sliderNumKeywordsWordcloudFormat.value,
                                                       sliderNumTopicDocuments.value)" color="primary"
                      mat-raised-button>
                Actualizar
              </button>
            </li>
          </ul>
        </div>

      </div>
    </mat-tab>
  </mat-tab-group>
</div>

<app-topic-documents-card></app-topic-documents-card>

<!-- TODO: Implement error messages with Boostrap alerts: https://getbootstrap.com/docs/4.3/components/alerts/ -->
